<!DOCTYPE html>

<html class="NDPage NDContentPage"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>rings_wallhack.lua</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.3 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');">

<script type="text/javascript">var q = window.location.search;if (q.startsWith("?Theme=")){var t = q.slice(7);var e = t.indexOf(";");if (e != -1){  t = t.slice(0, e);  }document.documentElement.classList.add(t + "Theme")}</script>

<a name="Examples.Wallhack_Pulse"></a><a name="Topic2"></a><div class="CTopic TClass LLua first">
 <div class="CTitle"><span class="Qualifier">Examples.</span>&#8203;Wallhack Pulse</div>
 <div class="CBody"><p>Draws an expanding pulse around the player, highlights NPC's through walls as the expanding ring passes them.</p><p>Uses <a href="../index.html#File:libraries/rendering/rings.lua:Libraries.rings" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,67);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >rings</a> along with some stencil magic.</p><pre class="CCode"><span class="SHKeyword">if</span> SERVER <span class="SHKeyword">then</span><br />    <span class="SHKeyword">return</span><br />end<br /><br />hook.Add(<span class="SHString">&quot;PostDrawTranslucentRenderables&quot;</span>, <span class="SHString">&quot;stencil rings&quot;</span>, <span class="SHKeyword">function</span>()<br />    local pos = LocalPlayer():GetPos()<br />    local radius = CurTime() * <span class="SHNumber">300</span> % <span class="SHNumber">1000</span><br />    local alpha = math.Remap(radius, <span class="SHNumber">0</span>, <span class="SHNumber">1000</span>, <span class="SHNumber">255</span>, <span class="SHNumber">0</span>)<br /><br />    render.StartRings()<br />        render.AddRing(pos, radius, <span class="SHNumber">20</span>, <span class="SHNumber">50</span>)<br /><br />        <span class="SHComment">-- Technical note, the stencil layout of the actual rings is as follows:</span><br />        <span class="SHComment">-- 0 - Outside</span><br />        <span class="SHComment">-- 1 - Border</span><br />        <span class="SHComment">-- 2 - Inside</span><br /><br />        render.SetStencilReferenceValue(<span class="SHNumber">1</span>)<br />        <span class="SHComment">-- Stencil comparisons compare the reference value to the stencil value, so in this case it checks 1 &lt;= stencil or stencil &gt; 1</span><br />        render.SetStencilCompareFunction(STENCIL_LESSEQUAL)<br />        render.SetStencilPassOperation(STENCIL_REPLACE)<br />        render.SetStencilZFailOperation(STENCIL_REPLACE)<br /><br />        local sqr = (radius + <span class="SHNumber">20</span>) * (radius + <span class="SHNumber">20</span>)<br /><br />        <span class="SHKeyword">for</span> _, ent <span class="SHKeyword">in</span> ipairs(ents.FindByClass(<span class="SHString">&quot;npc_*&quot;</span>)) <span class="SHKeyword">do</span><br />            <span class="SHComment">-- If you want to do this the proper way you're going to have to get a second depth buffer, write just your NPC's and a radius sphere to it with ZFail REPLACE to 1</span><br />            <span class="SHComment">-- then write the result back to the main view. Otherwise the walls are going to ZFail first and you'll see them through walls before the 'pulse' has reached them proper</span><br />            <span class="SHComment">--</span><br />            <span class="SHComment">-- It's probably possible, but entirely beyond me atm</span><br />            <span class="SHKeyword">if</span> ent:NearestPoint(pos):DistToSqr(pos) &lt; sqr <span class="SHKeyword">then</span><br />                ent:DrawModel()<br /><br />                local weapon = ent:GetActiveWeapon()<br /><br />                <span class="SHKeyword">if</span> IsValid(weapon) <span class="SHKeyword">then</span><br />                    weapon:DrawModel()<br />                end<br />            end<br />        end<br />    render.EndRings(Color(<span class="SHNumber">255</span>, <span class="SHNumber">0</span>, <span class="SHNumber">0</span>, alpha))<br />end)</pre></div>
</div>

</body></html>